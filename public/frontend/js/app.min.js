$(document).ready(function() {

$('[name="phone"]').mask("+375 (99) 999-99-99");

$(function(){
  $(".img-comp-container").twentytwenty({
    no_overlay : true,
    before_label : '' ,  // Установить кастом перед меткой 
    after_label : '' ,  // Установить кастом после метки 
  });
});

$('.section__content').append('<p class="vis-kvis"><span>Т</span><span>Е</span> <span>С</span><span>Т</span></i></p>');
 

$(function(){
$(window).on('resize', function(){

if (($(window).height()) < 900) {
        $('.scroll-menu').niceScroll({
    cursorcolor: "#fff",
    cursorwidth : "8px",
    cursorfixedheight: 8,
    cursoropacitymin : 1,
    background: "#eee"
});  // The document page (body)

    }else if($(window).width() > 900)
    {
      $(".menu-container").getNiceScroll().hide();
    }

});
$(window).resize(); // for first time
});


$(".s-floating").simple3D({
            moveX:1, // 1 - 5
            moveY:1, // 1 - 5
            bgImage:true,
            targetAll:true,
            reverseX: true,
            reverseY: true
        });



    var $element = $('.footer');
    let counter = 0;
$(window).scroll(function() {
  var scroll = $(window).scrollTop() + $(window).height();

  var offset = $element.offset().top
 
  if (scroll > offset && counter == 0) {
    $('.wrapper-kwiz').fadeOut(200);
    counter = 1;
  }else{
      $('.wrapper-kwiz').fadeIn(200);
  }     counter = 0;
});

 
$(".close-kvis").click(function() {
    $(this).parents(".wrapper-kwiz").removeClass("viz-kv"); 
    $(this).parents('body').find('.vis-kvis').removeClass("hidden"); 
 })
 
 $(".vis-kvis").click(function() {
    $(this).parents("body").find('.wrapper-kwiz').addClass("viz-kv");
    $(this).addClass('hidden');
 })
 
 


$('.scroll-pane').niceScroll({
    cursorcolor: "#fff",
    cursorwidth : "13px",
    cursorfixedheight: 13,
    cursoropacitymin : 1,
    background: "#eee"
});  // The document page (body)

	$('#section-slide').fullpage({
         licenseKey:'OPEN-SOURCE-GPLV3-LICENSE',
		    navigation: true,
		    fitToSection: true,
		    verticalCentered: false,
        responsiveWidth: 1420,
        scrollOverflow: false,
        loopHorizontal: false,
		onLeave: function(index, nextIndex, direction){
		if(direction === 'down'){
			stopSlide();
			}else if(direction === 'up'){
				playSlide();
			}
		}
	});


function scrollDown() {
  var vheight = $(window).height();
  $('html, body').animate({
    scrollTop: (Math.floor($(window).scrollTop() / vheight)+1) * vheight
  }, 500);  
};

  $('#scroll-down').click(function(event){
    scrollDown();
    event.preventDefault();
  });



	$('.header-slider').slick({
    infinite: false,
    autoplay: false,
    slidesToShow: 1,
    dots: true,
    arrows:true,
    speed: 1200,
    appendDots: $('.header__slider-dots'),
    appendArrows: $('.header__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    
});

  $('.header-slider').on('afterChange', function(){
        $('.slick-slide span').removeClass('slowanimate slow');
  $('.slick-slide.slick-active span').addClass('slowanimate');
});

$('.recipie-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    slidesToScroll: 2,
    dots: true,
    centerMode: false,
    arrows:true,
    appendDots: $('.recipie__slider-dots'),
    appendArrows: $('.recipie__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 2,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },
        {
            breakpoint: 680,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
});


$('.header__burger-menu').on('click', function(e){
		e.preventDefault();

		var menu = $('.menu-wrapper');

		menu.toggleClass('active');

	});

$('.burger-menu').on('click', function(e){
    e.preventDefault();

var openMenu = $(this).closest('.menu-wrapper');
    menu = $(this).closest('body').find('.header__burger-menu');
  
  openMenu.removeClass('active');
  menu.removeClass('active');
    
  });

  $(".header__burger-menu").click(function(){
    $(this).toggleClass("active");
});

$('.slider-internet-portal').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
    centerMode: false,
    arrows:true,
    appendArrows: $('.internet-portal__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    });

$('.slider-new-product').slick({
    infinite: false,
    autoplay:true,
    autoplaySpeed: 5000,
    speed: 600,
    slidesToShow: 1,
    dots: true,
    centerMode: false,
    arrows: true,
    fade:true,
    cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)',
    appendDots: $('.new__slider-dots'),
    appendArrows: $('.new__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
    });






$('.product-nav-slider').on('init reInit',function(event,slick){
  var amount = slick.slideCount;
  $('#range').attr('max',amount);
})

$('.product-nav-slider').on('afterChange',function(e,slick,currentSlide){
  $('#range').val(currentSlide+1);
})

$('#range').on('input change',function(){
  $('.product-nav-slider').slick('slickGoTo',this.value-1);
});




$('.catalog-slider').slick({
    autoplay:true,
    autoplaySpeed: 5000,
    speed: 600,
    slidesToShow: 1,
    dots: true,
    centerMode: false,
    arrows: true,
    fade:true,
    cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)',
    appendDots: $('.catalog__slider-dots'),
    appendArrows: $('.catalog__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
    });



$('.product-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
   	swipe: false,
    centerMode: false,
    arrows: false,
    asNavFor: '.product-nav-slider'
    });





// // var slickSlider = $('.product-slider');
//  function slickPause() {

//  	var slickOptions = {
//         swipe: false,
//         // rest of options
//     },
//     $slick = $('.product-slider');

// $slick.not('.slick-initialized').slick(slickOptions);

// };



// $('.img-comp-slider').mousedown(function() {
// 	slickPause();
// });

 var header = $('.header'),
    scrollPrev = 0;

  $(window).scroll(function() {
  var scrolled = $(window).scrollTop();
   
    if ( scrolled < 50) {
      header.removeClass('fixed-menu');
    }else {
      header.addClass('fixed-menu');
      
    }
    scrollPrev = scrolled;
});




// $slick.slick(slickOptions);

// // built-in feature, for more info check the [doc](http://kenwheeler.github.io/slick/)
// $slick.on('mouseover', function(event, slick, direction) {
//     $('.img-comp-slider');
// });


// $ ('.product-slider').on('mouseover', function () {
//  swipe: false
// });
// mouseover

$('.product-nav-slider').slick({
    autoplay:false,
    slidesToShow: 4,
    dots: false,
    asNavFor: '.product-slider',
    arrows: false,
    infinite: false
    });

//PREV
// $('.img-comp-slider').on('click', function(){
//                 $('.product-slider').slick('unslick');
//         console.log('stop')

//             });

// $('.img-comp-slider').on('mouseleave', function(){

//         $('.product-slider').slick('slickPlay');
//         console.log('play')

//             });






// // Remove active class from all thumbnail slides
//  $('.product-nav-slider .slick-slide').removeClass('slick-active');

//  // Set active class to first thumbnail slides
//  $('.product-nav-slider .slick-slide').eq(0).addClass('slick-active');
//  // On before slide change match active thumbnail to current slide
//  $('.product-slider').on('beforeChange', function (event, slick, currentSlide, nextSlide) {
//     var mySlideNumber = nextSlide;
//     $('.product-nav-slider .slick-slide').removeClass('slick-active');
//     $('.product-nav-slider .slick-slide').eq(mySlideNumber).addClass('slick-active');
// });


 $('.product-nav-slider .product-nav-slider-item').click(function(){
     
  var goToSlide = $(this).closest('.slick-slide').data('slick-index');
  $('.product-slider').slick('slickGoTo', parseInt(goToSlide));
  
  $(this).closest('.slick-list').find('.slick-slide').removeClass('active', parseInt(goToSlide));
 $(this).addClass('active', parseInt(goToSlide));
  
  
 });


$('.recommend-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 4,
    dots: true,
    centerMode: false,
    arrows: true,
    appendDots: $('.recommend__slider-dots'),
    appendArrows: $('.recommend__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 2,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },{
            breakpoint: 580,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
    });
$(".certificate-slider").lightGallery(); 
$('.certificate-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    dots: true,
    centerMode: false,
    arrows: true,
    appendDots: $('.cert__slider-dots'),
    appendArrows: $('.cert__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [{
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },{
            breakpoint: 580,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
    });
    
    
$('.videogallery').lightGallery();

$(".recipe-thumbnail-gallery").lightGallery(); 

$(".item-thumbnail-gallery").lightGallery(); 

$('.history-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
    centerMode: false,
    arrows: false,
    asNavFor: '.history-slider-thumb'
    
    });

$('.history-slider-thumb').slick({
    dots: false,
    arrows: true,
    slidesToShow: 7,
    slidesToScroll: 1,
    appendDots: $('.history__slider-dots'),
    verticalSwiping: true,
    asNavFor: '.history-slider',
    infinite: false,
    focusOnSelect: true,
    centerMode:true,
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
     responsive: [
          {
              breakpoint: 1100,
              settings: {
                  slidesToShow: 5,
                  slidesToScroll: 1
              }
          },{
              breakpoint: 780,
              settings: {
                  slidesToShow: 3,
              }
          },{
              breakpoint: 480,
              settings: {
                  slidesToShow: 1
              }
          }
      ]
});

    
$('.news-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    slidesToScroll: 3,
    dots: true,
    arrows: true,
    appendDots: $('.news__slider-dots'),
    appendArrows: $('.news__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 3,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },
        {
            breakpoint: 680,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                dots: false
            }
        }
    ]
    });





 
    $('.quiz-slider').slick({
      infinite: false,
    autoplay: false,
    slidesToShow: 2,
    dots: true,
    arrows: true,
    appendDots: $('.quiz__slider-dots'),
    appendArrows: $('.quiz__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
  });


  






var fileInput  = document.querySelector( ".custom-file-input" ),
        the_return = document.querySelector(".file-return")
  fileInput.addEventListener( "change", function( event ) {  
    the_return.innerHTML = this.value;  });



//Добавляет клас на клик и по клику вне этого элемента удаляет класс is-open
    $('.dropdown-custom').on('click', function() {
        var $this = $(this)
        if ($this.hasClass('is-open')) {
            $this.removeClass('is-open');

        }
        else {
            $this.addClass('is-open');
        }
    });
    $(document).on('click', 'body',  function(event) {
        if (!$(event.target).closest('.dropdown-custom').length) {

            $('.dropdown-custom').removeClass('is-open');
        }
    });



   $('.collapse.in').prev('.panel-heading').addClass('active');
    $('#accordion, #bs-collapse')
      .on('show.bs.collapse', function(a) {
        $(a.target).prev('.panel-heading').addClass('active');
      })
      .on('hide.bs.collapse', function(a) {
        $(a.target).prev('.panel-heading').removeClass('active');
      });


	function stopSlide(){
		$('.header-slider').slick('slickPause');
		console.log('stop')
	}
	function playSlide(){
		$('.header-slider').slick('slickPlay');
		console.log('play')
	}
	$(window).on('load resize', function(){
	$('.bg').height($(window).height());
})

$(".drop-down").hover(function() {
        $('.header__menu-sub').addClass('visible-on');
    });
    $(".drop-down").mouseleave(function() {
        $('.header__menu-sub').removeClass('visible-on');
    });

});

$('.header__menu ul .menu-li').hover(function(){
    var navOffset = $(this).position().left;
    var navItemWidth = $(this).width();
    var parent = $('.header__menu');
    
   $('.dot').css('left', navOffset + navItemWidth / 2); 
});


var activeOffset = $('.parent-menu li').position().top;
var activeItemHeight = $('.parent-menu li').height();

$('document').ready(function(){
    $('.dot-menu').css('top', activeOffset + activeItemHeight / 2);
});


$('.parent-menu>li').hover(function(){
    var navOffset = $(this).position().top;
    var navItemHeight = $(this).height();
    
    $('.dot-menu').css('top', navOffset + navItemHeight / 2);
  
});


$(document).ready(function () {
  // Privacy notification
    $('#close-cookies').on("click", function(e){
        e.preventDefault();
        $('.cookies').slideUp();
    });

    AOS.init({
          duration: 900,
                once: true
});

 $('.menu-mobile-product .parent-menu').slick({
  dots: false,
  arrows: true,
  slidesToShow: 4,
  infinite: false,
  slidesToScroll: 1,
  mobileFirst: true,
  prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
  responsive: [{
    breakpoint: 680,
    slidesToShow: 7,
  },{
    breakpoint: 992,
    settings: 'unslick'
  }]
});

    

//Search navbar
  $('.search-btn').click(function(e){
    e.preventDefault();
    var search_form = $('.search-nav-wrapper');
    search_form.toggleClass('active');
  });

  $('.search-nav-wrapper .close').click(function(){
    var search_form = $('.search-nav-wrapper');

        search_form.toggleClass('active');
  });
    
});



$("a[href='#top']").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});


$(document).on('scroll', function(){
    	if (window.pageYOffset > 600) {
            $('.back-top').css('opacity', 1);
        } else {
            $('.back-top').css('opacity', 0);
        }
    });
     
	$('.back-top').click(function () {
	      $('body,html').animate({
	          scrollTop: 0
	      }, 600);
	      return false;
	}); 


  // quiz 

  var steps = $("form").children(".step"); // находим все шаги формы
      stepsTotal = steps.length -1;
      counter = $('.step-current');

  $('.step-total').html(stepsTotal);
  $('.step-counter').fadeOut();

  $(steps[0]).show(); // показываем первый шаг
  var current_step = 0; // задаем текущий шаг

  $(".next").click(function(e){ // Событие клика на ссылку "Следующий шаг"
      e.preventDefault();
      var name=$('.username').val();
      if(name.length<2){
        e.stopPropagation();
        $('.req_block').css('display', 'flex');
      }else{
        var form = $("#quiz-form");    

      if(current_step == 7){current_step = 0}; 

      $(steps).fadeOut();

      if (current_step == steps.length-2 ) { // проверяем, будет ли следующий шаг последним
        $(this).hide(); // скрываем ссылку "Следующий шаг"
        $(".start-over").css({'display': 'flex'});
        $(".btn-transparent").css({'display': 'flex'});
        $(this).closest('.form').find('.title-red').hide();
      }
      if(current_step !== 1){
        $(".form-btn-growp .next").addClass('btn-arrow').text("Далее");
        $('.step-counter').fadeIn();
      }
      if(current_step === 5){
        $(".form-btn-growp .next").text("Завершить тест и получить рекомендацию").css('width','430px');
      }
      current_step++; // увеличиваем счетчик текущего слайда
      counter.html(current_step);
      changeStep(current_step); // меняем шаг
      }
      
  });

  $(".start-over").click(function(e){
      e.preventDefault();

      $(steps[0]).show(); // показываем первый шаг
      var current_step = 0
        $(steps).hide();
        $(steps[0]).show(); // показываем первый шаг
      

    if(current_step == 0){
      $(".form-btn-growp .next").css({'display':'flex','width':'145px'}).removeClass('btn-arrow').text("Начать тест");
      $('.step-counter').css('display','none');
      $(this).closest('.form').find('.title-red').show();
    }
    if(current_step !== 6){
      $('.start-over').hide();
      $('.btn-transparent').hide();
    }

      counter.html(current_step);
      changeStep(current_step); 
  });

  
  function changeStep(i) { // функция смены шага
    $(steps).hide(); // скрываем все шаги
    $(steps[i]).show(); // показываем текущий
  };



// $(document).ready(function() {
//  $(".menu-left-products").each(function () { // обрабатываем каждый слайдер
//   var obj = $(this);
//   $(obj).append("<div class='nav'></div>");
//   $(obj).find("li").each(function () {
//    $(obj).find(".nav").append("<span rel='"+$(this).index()+"'></span>"); // добавляем блок навигации
//    $(this).addClass("slider"+$(this).index());
//   });
//   $(obj).find("span").first().addClass("on"); // делаем активным первый элемент меню
//  });
// });
// function sliderJS (obj, sl) { // slider function
//  var ul = $(sl).find("ul"); // находим блок
//  var bl = $(sl).find("li.slider"+obj); // находим любой из элементов блока
//  var step = $(bl).width(); // ширина объекта
//  $(ul).animate({marginLeft: "-"+step*obj}, 500); // 500 это скорость перемотки
// }
// $(document).on("click", ".menu-left-products .nav span", function() { // slider click navigate
//  var sl = $(this).closest(".menu-left-products"); // находим, в каком блоке был клик
//  $(sl).find("span").removeClass("on"); // убираем активный элемент
//  $(this).addClass("on"); // делаем активным текущий
//  var obj = $(this).attr("rel"); // узнаем его номер
//  sliderJS(obj, sl); // слайдим
//  return false;
// });

$(document).ready(function() {
    $('form[id="appeal"]').submit(function( event ) {
        event.preventDefault();
        var $that = $(this),
        formData = new FormData($that.get(0));
        
        $.ajax({
            method: "POST",
            url: "/appeal",
            data: formData,
            dataType: 'html',
            processData: false, // Не обрабатываем файлы (Don't process the files)
            contentType: false,
            success: function(response){
                $("#success").modal('show');
		    	setTimeout(function() {$('#success').modal('hide') }, 3000);
            }
        });
        return false;
    });
    
    $('form[id="appeal-yr"]').submit(function( event ) {
        event.preventDefault();
        var $that = $(this),
        formData = new FormData($that.get(0));
        
        $.ajax({
            method: "POST",
            url: "/appeal",
            data: formData,
            dataType: 'html',
            processData: false, // Не обрабатываем файлы (Don't process the files)
            contentType: false,
            success: function(response){
                $("#success").modal('show');
		    	setTimeout(function() {$('#success').modal('hide') }, 3000);
            }
        });
        return false;
    });
    
    $('form[id="order-product"]').submit(function( event ) {
        event.preventDefault();
        var array = $(this).serializeArray();
        
        $.ajax({
            method: "POST",
            url: "/order-product",
            data: array,
            dataType: 'html',
            success: function(response){
                console.log(array);
                $("#modal-order").modal('hide');
                $("#success").modal('show');
		    	setTimeout(function() {$('#success').modal('hide') }, 3000);
            }
        });
        return false;
    });
    
    $('form[id="call-back"]').submit(function( event ) {
        event.preventDefault();
        var $that = $(this),
        formData = new FormData($that.get(0));
        
        $.ajax({
            method: "POST",
            url: "/call-back",
            data: formData,
            dataType: 'html',
            processData: false, // Не обрабатываем файлы (Don't process the files)
            contentType: false,
            success: function(response){
                $("#modal-order").modal('hide');
                $("#success").modal('show');
		    	setTimeout(function() {$('#success').modal('hide') }, 3000);
            }
        });
        return false;
    });
    
});


