$(document).ready(function() {



$('.scroll-pane').niceScroll({
    cursorcolor: "#fff",
    cursorwidth : "13px",
    cursorfixedheight: 13,
    cursoropacitymin : 1,
    background: "#eee"
});  // The document page (body)

	$('#section-slide').fullpage({
         licenseKey:'OPEN-SOURCE-GPLV3-LICENSE',
		    navigation: true,
		    fitToSection: false,
		    verticalCentered: false,
        responsiveWidth: 1200,
        loopHorizontal:false,
		onLeave: function(index, nextIndex, direction){
		if(direction === 'down'){
			stopSlide();
			}else if(direction === 'up'){
				playSlide();
			}
		}
	});


function scrollDown() {
  var vheight = $(window).height();
  $('html, body').animate({
    scrollTop: (Math.floor($(window).scrollTop() / vheight)+1) * vheight
  }, 500);  
};

  $('#scroll-down').click(function(event){
    scrollDown();
    event.preventDefault();
  });



	$('.header-slider').slick({
    infinite: false,
    autoplay: true,
    slidesToShow: 1,
    dots: true,
    arrows:true,
    speed: 900,
    appendDots: $('.header__slider-dots'),
    appendArrows: $('.header__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    
});

  $('.header-slider').on('afterChange', function(){
        $('.slick-slide span').removeClass('slowanimate slow');
  $('.slick-slide.slick-active span').addClass('slowanimate');
});

$('.recipie-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    dots: true,
    centerMode: false,
    arrows:true,
    appendDots: $('.recipie__slider-dots'),
    appendArrows: $('.recipie__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 1,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 1
            }
        },
        {
            breakpoint: 680,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
});


$('.header__burger-menu').on('click', function(e){
		e.preventDefault();

		var menu = $('.menu-wrapper');

		menu.toggleClass('active');

	});

$('.burger-menu').on('click', function(e){
    e.preventDefault();

var openMenu = $(this).closest('.menu-wrapper');
    menu = $(this).closest('body').find('.header__burger-menu');
  
  openMenu.removeClass('active');
  menu.removeClass('active');
    
  });

  $(".header__burger-menu").click(function(){
    $(this).toggleClass("active");
});

$('.slider-internet-portal').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
    centerMode: false,
    arrows:true,
    appendArrows: $('.internet-portal__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    });

$('.slider-new-product').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: true,
    centerMode: false,
    arrows: true,
    fade:true,
    cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)',
    appendDots: $('.new__slider-dots'),
    appendArrows: $('.new__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
    });






$('.product-nav-slider').on('init reInit',function(event,slick){
  var amount = slick.slideCount;
  $('#range').attr('max',amount);
})

$('.product-nav-slider').on('afterChange',function(e,slick,currentSlide){
  $('#range').val(currentSlide+1);
})

$('#range').on('input change',function(){
  $('.product-nav-slider').slick('slickGoTo',this.value-1);
});




$('.catalog-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: true,
    centerMode: false,
    arrows: true,
    fade:true,
    cssEase: 'cubic-bezier(0.7, 0, 0.3, 1)',
    appendDots: $('.catalog__slider-dots'),
    appendArrows: $('.catalog__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
    });



$('.product-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
   	swipe: false,
    centerMode: false,
    arrows: false,
    asNavFor: '.product-nav-slider'
    });





// // var slickSlider = $('.product-slider');
//  function slickPause() {

//  	var slickOptions = {
//         swipe: false,
//         // rest of options
//     },
//     $slick = $('.product-slider');

// $slick.not('.slick-initialized').slick(slickOptions);

// };



// $('.img-comp-slider').mousedown(function() {
// 	slickPause();
// });

 var header = $('.header'),
    scrollPrev = 0;

  $(window).scroll(function() {
  var scrolled = $(window).scrollTop();
   
    if ( scrolled < 50) {
      header.removeClass('fixed-menu');
    }else {
      header.addClass('fixed-menu');
      
    }
    scrollPrev = scrolled;
});




// $slick.slick(slickOptions);

// // built-in feature, for more info check the [doc](http://kenwheeler.github.io/slick/)
// $slick.on('mouseover', function(event, slick, direction) {
//     $('.img-comp-slider');
// });


// $ ('.product-slider').on('mouseover', function () {
//  swipe: false
// });
// mouseover

$('.product-nav-slider').slick({
    autoplay:false,
    slidesToShow: 4,
    dots: false,
    asNavFor: '.product-slider',
    arrows: false,
    infinite: false
    });

//PREV
// $('.img-comp-slider').on('click', function(){
//                 $('.product-slider').slick('unslick');
//         console.log('stop')

//             });

// $('.img-comp-slider').on('mouseleave', function(){

//         $('.product-slider').slick('slickPlay');
//         console.log('play')

//             });






// // Remove active class from all thumbnail slides
//  $('.product-nav-slider .slick-slide').removeClass('slick-active');

//  // Set active class to first thumbnail slides
//  $('.product-nav-slider .slick-slide').eq(0).addClass('slick-active');
//  // On before slide change match active thumbnail to current slide
//  $('.product-slider').on('beforeChange', function (event, slick, currentSlide, nextSlide) {
//     var mySlideNumber = nextSlide;
//     $('.product-nav-slider .slick-slide').removeClass('slick-active');
//     $('.product-nav-slider .slick-slide').eq(mySlideNumber).addClass('slick-active');
// });


 $('.product-nav-slider .product-nav-slider-item').click(function(){
     
  var goToSlide = $(this).closest('.slick-slide').data('slick-index');
  $('.product-slider').slick('slickGoTo', parseInt(goToSlide));
  
  $(this).closest('.slick-list').find('.slick-slide').removeClass('active', parseInt(goToSlide));
 $(this).addClass('active', parseInt(goToSlide));
  
  
 });


$('.recommend-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 4,
    dots: true,
    centerMode: false,
    arrows: true,
    appendDots: $('.recommend__slider-dots'),
    appendArrows: $('.recommend__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 2,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },{
            breakpoint: 580,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
    });
$(".certificate-slider").lightGallery(); 
$('.certificate-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    dots: true,
    centerMode: false,
    arrows: true,
    appendDots: $('.cert__slider-dots'),
    appendArrows: $('.cert__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [{
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        },{
            breakpoint: 580,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
    });

$(".recipe-thumbnail-gallery").lightGallery(); 

$(".item-thumbnail-gallery").lightGallery(); 

$('.history-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 1,
    dots: false,
    centerMode: false,
    arrows: false,
    asNavFor: '.history-slider-thumb'
    });

$('.history-slider-thumb').slick({
    dots: false,
    arrows: true,
    slidesToShow: 7,
    slidesToScroll: 1,
    appendDots: $('.history__slider-dots'),
    verticalSwiping: true,
    asNavFor: '.history-slider',
    infinite: false,
    focusOnSelect: true,
    centerMode:true,
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
     responsive: [
          {
              breakpoint: 1100,
              settings: {
                  slidesToShow: 5,
                  slidesToScroll: 1
              }
          },{
              breakpoint: 780,
              settings: {
                  slidesToShow: 3,
                  slidesToScroll: 1
              }
          }
      ]
});

    
$('.news-slider').slick({
    infinite: false,
    autoplay:false,
    slidesToShow: 3,
    dots: true,
    arrows: true,
    appendDots: $('.news__slider-dots'),
    appendArrows: $('.news__slider-arrows'),
   prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
    responsive: [
        {
            breakpoint: 1200,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 1,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 1
            }
        },
        {
            breakpoint: 680,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }
    ]
    });




$('#modal-quiz').on('shown.bs.modal', function() {
  $('.quiz-slider').not('.slick-initialized').slick();
});


  $('.quiz-slider').slick({
    infinite: false,
    autoplay: false,
    slidesToShow: 2,
    dots: true,
    arrows: true,
    appendDots: $('.quiz__slider-dots'),
    appendArrows: $('.quiz__slider-arrows'),
    prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>'
    });






//Добавляет клас на клик и по клику вне этого элемента удаляет класс is-open
    $('.dropdown-custom').on('click', function() {
        var $this = $(this)
        if ($this.hasClass('is-open')) {
            $this.removeClass('is-open');

        }
        else {
            $this.addClass('is-open');
        }
    });
    $(document).on('click', 'body',  function(event) {
        if (!$(event.target).closest('.dropdown-custom').length) {

            $('.dropdown-custom').removeClass('is-open');
        }
    });



   $('.collapse.in').prev('.panel-heading').addClass('active');
    $('#accordion, #bs-collapse')
      .on('show.bs.collapse', function(a) {
        $(a.target).prev('.panel-heading').addClass('active');
      })
      .on('hide.bs.collapse', function(a) {
        $(a.target).prev('.panel-heading').removeClass('active');
      });


	function stopSlide(){
		$('.header-slider').slick('slickPause');
		console.log('stop')
	}
	function playSlide(){
		$('.header-slider').slick('slickPlay');
		console.log('play')
	}
	$(window).on('load resize', function(){
	$('.bg').height($(window).height());
})

$(".drop-down").hover(function() {
        $('.header__menu-sub').addClass('visible-on');
    });
    $(".drop-down").mouseleave(function() {
        $('.header__menu-sub').removeClass('visible-on');
    });

});

function initComparisons() {
  var x, i;
  /* Find all elements with an "overlay" class: */
  x = document.getElementsByClassName("img-comp-overlay");
  for (i = 0; i < x.length; i++) {
    /* Once for each "overlay" element:
    pass the "overlay" element as a parameter when executing the compareImages function: */
    compareImages(x[i]);
  }
  function compareImages(img) {
    var slider, img, clicked = 0, w, h;
    /* Get the width and height of the img element */
    w = img.offsetWidth;
    h = img.offsetHeight;
    /* Set the width of the img element to 50%: */
    img.style.width = (w / 2) + "px";
    /* Create slider: */
    slider = document.createElement("DIV");
    slider.setAttribute("class", "img-comp-slider");
    /* Insert slider */
    img.parentElement.insertBefore(slider, img);
    /* Position the slider in the middle: */
    slider.style.top = (h / 2) - (slider.offsetHeight / 2) + "px";
    slider.style.left = (w / 2) - (slider.offsetWidth / 2) + "px";
    /* Execute a function when the mouse button is pressed: */
    slider.addEventListener("mousedown", slideReady);
    /* And another function when the mouse button is released: */
    window.addEventListener("mouseup", slideFinish);
    /* Or touched (for touch screens: */
    slider.addEventListener("touchstart", slideReady);
     /* And released (for touch screens: */
    window.addEventListener("touchstop", slideFinish);
    function slideReady(e) {
      /* Prevent any other actions that may occur when moving over the image: */
      e.preventDefault();
      /* The slider is now clicked and ready to move: */
      clicked = 1;
      /* Execute a function when the slider is moved: */
      window.addEventListener("mousemove", slideMove);
      window.addEventListener("touchmove", slideMove);
    }
    function slideFinish() {
      /* The slider is no longer clicked: */
      clicked = 0;
    }
    function slideMove(e) {
      var pos;
      /* If the slider is no longer clicked, exit this function: */
      if (clicked == 0) return false;
      /* Get the cursor's x position: */
      pos = getCursorPos(e)
      /* Prevent the slider from being positioned outside the image: */
      if (pos < 0) pos = 0;
      if (pos > w) pos = w;
      /* Execute a function that will resize the overlay image according to the cursor: */
      slide(pos);
    }
    function getCursorPos(e) {
      var a, x = 0;
      e = e || window.event;
      /* Get the x positions of the image: */
      a = img.getBoundingClientRect();
      /* Calculate the cursor's x coordinate, relative to the image: */
      x = e.pageX - a.left;
      /* Consider any page scrolling: */
      x = x - window.pageXOffset;
      return x;
    }
    function slide(x) {
      /* Resize the image: */
      img.style.width = x + "px";
      /* Position the slider: */
      slider.style.left = img.offsetWidth - (slider.offsetWidth / 2) + "px";
    }
  }
}

initComparisons();


$('.header__menu ul .menu-li').hover(function(){
    var navOffset = $(this).position().left;
    var navItemWidth = $(this).width();
    var parent = $('.header__menu');

    
   $('.dot').css('left', navOffset + navItemWidth / 2); 
});



var activeOffset = $('.parent-menu li').position().top;
var activeItemHeight = $('.parent-menu li').height();

$('document').ready(function(){
    $('.dot-menu').css('top', activeOffset + activeItemHeight / 2);
});


$('.parent-menu>li').hover(function(){
    var navOffset = $(this).position().top;
    var navItemHeight = $(this).height();
    
    $('.dot-menu').css('top', navOffset + navItemHeight / 2);
  
});


$(document).ready(function () {
  // Privacy notification
        setTimeout(function(){
          $('.cookies').slideDown();
        },5000);

    $('#close-cookies').on("click", function(e){
        e.preventDefault();
        $('.cookies').slideUp();
    });

    AOS.init({
          duration: 900,
                once: true
});

 $('.menu-mobile-product .parent-menu').slick({
  dots: false,
  arrows: true,
  slidesToShow: 4,
  infinite: false,
  slidesToScroll: 1,
  mobileFirst: true,
  prevArrow: '<button type="button" class="btn btn-default prev"><img src="/frontend/images/icon/arrow-left.png" alt="left" /></button>',
    nextArrow: '<button type="button" class="btn btn-default next"><img src="/frontend/images/icon/arrow-right.png" alt="right" /></button>',
  responsive: [{
    breakpoint: 680,
    slidesToShow: 7,
  },{
    breakpoint: 992,
    settings: 'unslick'
  }]
});

    

//Search navbar
  $('.search-btn').click(function(e){
    e.preventDefault();
    var search_form = $('.search-nav-wrapper');
    search_form.toggleClass('active');
  });

  $('.search-nav-wrapper .close').click(function(){
    var search_form = $('.search-nav-wrapper');

        search_form.toggleClass('active');
  });
    
});



$("a[href='#top']").click(function() {
  $("html, body").animate({ scrollTop: 0 }, "slow");
  return false;
});


$(document).on('scroll', function(){
    	if (window.pageYOffset > 600) {
            $('.back-top').css('opacity', 1);
        } else {
            $('.back-top').css('opacity', 0);
        }
    });
     
	$('.back-top').click(function () {
	      $('body,html').animate({
	          scrollTop: 0
	      }, 600);
	      return false;
	}); 


  // quiz 

  var steps = $("form").children(".step"); // находим все шаги формы
      stepsTotal = steps.length -1;
      counter = $('.step-current');

  $('.step-total').html(stepsTotal);
  $('.step-counter').fadeOut();

  $(steps[0]).show(); // показываем первый шаг
  var current_step = 0; // задаем текущий шаг

  $(".next").click(function(e){ // Событие клика на ссылку "Следующий шаг"
      e.preventDefault();

      if(current_step == 6){current_step = 0}; 

      $(steps).fadeOut();

      // $(steps).removeClass('animate-in');
      // $(steps).addClass('animate-out');
      //     setTimeout(function(){
      //     $(steps).removeClass('animate-out');;
      //   }, 100);
      //     setTimeout(function(){
      //     $(steps).addClass('animate-in');;
      //   }, 120);


    if (current_step == steps.length-2 ) { // проверяем, будет ли следующий шаг последним
      $(this).hide(); // скрываем ссылку "Следующий шаг"
      $(".start-over").css({'display': 'flex'});
      $(".btn-transparent").css({'display': 'flex'});
      $(this).closest('.form').find('.title-red').hide();
    }
    if(current_step !== 1){
      $(".form-btn-growp .next").addClass('btn-arrow').text("Далее");
      $('.step-counter').fadeIn();
    }
    if(current_step === 4){
      $(".form-btn-growp .next").text("Завешить тест и получить рекомендацию").css('width','430px');
    }
    current_step++; // увеличиваем счетчик текущего слайда
    counter.html(current_step);
    changeStep(current_step); // меняем шаг
  });

  $(".start-over").click(function(e){
      e.preventDefault();

      $(steps[0]).show(); // показываем первый шаг
      var current_step = 0
        $(steps).hide();
        $(steps[0]).show(); // показываем первый шаг
      

    if(current_step == 0){
      $(".form-btn-growp .next").css({'display':'flex','width':'145px'}).removeClass('btn-arrow').text("Начать тест");
      $('.step-counter').css('display','none');
      $(this).closest('.form').find('.title-red').show();
    }
    if(current_step !== 6){
      $('.start-over').hide();
      $('.btn-transparent').hide();
    }

      counter.html(current_step);
      changeStep(current_step); 
  });

  
  function changeStep(i) { // функция смены шага
    $(steps).hide(); // скрываем все шаги
    $(steps[i]).show(); // показываем текущий
  };



// $(document).ready(function() {
//  $(".menu-left-products").each(function () { // обрабатываем каждый слайдер
//   var obj = $(this);
//   $(obj).append("<div class='nav'></div>");
//   $(obj).find("li").each(function () {
//    $(obj).find(".nav").append("<span rel='"+$(this).index()+"'></span>"); // добавляем блок навигации
//    $(this).addClass("slider"+$(this).index());
//   });
//   $(obj).find("span").first().addClass("on"); // делаем активным первый элемент меню
//  });
// });
// function sliderJS (obj, sl) { // slider function
//  var ul = $(sl).find("ul"); // находим блок
//  var bl = $(sl).find("li.slider"+obj); // находим любой из элементов блока
//  var step = $(bl).width(); // ширина объекта
//  $(ul).animate({marginLeft: "-"+step*obj}, 500); // 500 это скорость перемотки
// }
// $(document).on("click", ".menu-left-products .nav span", function() { // slider click navigate
//  var sl = $(this).closest(".menu-left-products"); // находим, в каком блоке был клик
//  $(sl).find("span").removeClass("on"); // убираем активный элемент
//  $(this).addClass("on"); // делаем активным текущий
//  var obj = $(this).attr("rel"); // узнаем его номер
//  sliderJS(obj, sl); // слайдим
//  return false;
// });


